@using LibrarySystemApplication.Models.Account
@using Microsoft.AspNetCore.Identity
@inject UserManager<Member> userManager
@using System.Security.Claims


<button class="btn btn-light toggle-btn shadow-sm " onclick="toggleSidebar()">
    <i class="bi bi-list fs-5"></i>
</button>

<!-- Sidebar -->
<div class="sidebar" id="sidebar">
    <div class="sidebar-header p-3">
        <div class="d-flex align-items-center justify-content-between">
            <h5 class="mb-0">Feed</h5>

            <div class="d-flex align-items-center">

                <button class="btn btn-light btn-sm ms-2" id="toggleSidebarBtn" onclick="toggleSidebar()"
                    style="display:none;">
                    <i class="bi bi-box-arrow-right"></i>
                </button>


            </div>
        </div>
    </div>


    @if (User.IsInRole("Admin") || User.IsInRole("Librarian"))
    {

        <div class="p-3 border-bottom">
            <h6 class="mb-0">@userManager.Users.FirstOrDefault(u => u.Id ==
                            User.FindFirstValue(ClaimTypes.NameIdentifier))?.Name</h6>
        <small class="text-muted">@User?.Claims.FirstOrDefault(c => c.Type == ClaimTypes.Role)?.Value</small>
    </div>
    <nav class="nav flex-column mt-2">

        @if (User.IsInRole("Admin"))
            {
                <a href="@Url.Action("Dashboard", "Admin")" class="nav-link @Html.IsActive("/Admin/Dashboard")">
                    <i class="bi bi-speedometer2 me-2"></i>
                    Dashboard
                </a>

                <a href="@Url.Action("ManageBooks", "Admin")" class="nav-link @Html.IsActive("/Admin/ManageBooks")">
                    <i class="bi bi-book-half me-2"></i>
                    Manage Books
                </a>

                <a href="@Url.Action("ManageLibrarians", "Admin")" class="nav-link @Html.IsActive("/Admin/ManageLibrarians")">
                    <i class="bi bi-people me-2"></i>
                    Manage Librarians
                </a>
            }
            else if (User.IsInRole("Librarian"))
            {
                <a href="@Url.Action("Dashboard", "Librarian")" class="nav-link @Html.IsActive("/Librarian/Dashboard")">
                    <i class="bi bi-speedometer2 me-2"></i>
                    Dashboard
                </a>
                <a href="@Url.Action("ManageBooks", "Librarian")" class="nav-link @Html.IsActive("/Librarian/ManageBooks")">
                    <i class="bi bi-book-half me-2"></i>
                    Manage Books
                </a>
                <a href="@Url.Action("Requests", "Librarian")" class="nav-link @Html.IsActive("/Librarian/Requests")">
                    <i class="bi bi-folder-check me-2"></i>
                    Manage Requests
                </a>
            }
        </nav>
    }
    else
    {
        <!-- Member Sidebar -->
        <div class="p-3 border-bottom">
            <div class="d-flex align-items-center">
                <img src="https://placehold.co/50" class="rounded-circle me-2" alt="User">
                <div>
                    <h6 class="mb-0">
                        @User?.Identity?.Name
                        (@User.FindFirst(ClaimTypes.Role)?.Value)
                    </h6>
                    <small class="text-muted"><span class="user-status"></span> Online</small>
                </div>
            </div>
        </div>

        <nav class="nav flex-column mt-2">
            <a href="/MainLibrary" class="nav-link @Html.IsActive("/MainLibrary")">
                <i class="bi bi-house me-2"></i>
                Feed
            </a>
            <a href="/Member/AccountBoard" class="nav-link @Html.IsActive("/Member/AccountBoard")">
                <i class="bi bi-person me-2"></i>
                Profile
            </a>
            <a href="/Member/MyBooks" class="nav-link @Html.IsActive("/Member/MyBooks")">
                <i class="bi bi-book me-2"></i>
                My Books
            </a>
            <a href="/Member/MyRequests" class="nav-link @Html.IsActive("/Member/MyRequests")">
                <i class="bi bi-folder me-2"></i>
                Requests
            </a>
        </nav>
    }



    <div class="position-absolute bottom-0 w-100 p-3 border-top">
        <form asp-action="Logout" asp-controller="Account" method="post" class="d-inline">
            <button type="submit" class="btn btn-light btn-sm">
                Logout <i class="bi bi-door-closed"></i>
            </button>
        </form>
    </div>




    @* <!-- Recent Activity -->
        <div class="p-3 mt-3">
            <h6 class="text-muted mb-3">Recent Activity</h6>
            <div class="d-flex align-items-center mb-3">
                <div class="bg-light rounded p-2 me-2">
                    <i class="bi bi-file-text"></i>
                </div>
                <div>
                    <small class="d-block">Updated Project Files</small>
                    <small class="text-muted">2 hours ago</small>
                </div>
            </div>
            <div class="d-flex align-items-center">
                <div class="bg-light rounded p-2 me-2">
                    <i class="bi bi-people"></i>
                </div>
                <div>
                    <small class="d-block">Team Meeting</small>
                    <small class="text-muted">4 hours ago</small>
                </div>
            </div>
        </div> *@
</div>

<script>
    let isOpen = true;

    function toggleSidebar() {
        isOpen = !isOpen;

        const sidebar = document.getElementById('sidebar');
        const toggleBtn = document.querySelector('.toggle-btn');
        const buttonClose = document.getElementById('toggleSidebarBtn');

        sidebar.classList.toggle('collapsed');
        toggleBtn.classList.toggle('collapsed');

        if (isOpen) {
            buttonClose.style.display = 'block';
            toggleBtn.style.display = 'none';
        } else {
            buttonClose.style.display = 'none';
            toggleBtn.style.display = 'block';
        }
    }
</script>